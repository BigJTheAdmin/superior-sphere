---
import { siteConfig } from "@/site.config";

interface Props {
  title?: string;
  description?: string;
  ogImage?: string;     // absolute URL or path under /public
  articleDate?: string; // ISO string if this page is an article
}

const p = Astro.props as Props;

// Page meta with sane fallbacks
const title       = p.title ?? siteConfig.title;
const description = p.description ?? siteConfig.description;
const articleDate = p.articleDate ?? "";

// Prefer your configured domain in site.config.ts; fall back to dev origin
const origin =
  (siteConfig.url && siteConfig.url.trim().length > 0)
    ? siteConfig.url.replace(/\/$/, "")
    : (Astro.url?.origin || "").replace(/\/$/, "");

// Canonical uses the current path from Astro plus the chosen origin
const canonical = `${origin}${Astro.url?.pathname || "/"}`;

// Resolve og:image to an absolute URL (accept absolute or local paths)
const rawOg = p.ogImage ?? "/og-image.png";
const ogPath = rawOg.startsWith("http")
  ? rawOg
  : `${origin}${rawOg.startsWith("/") ? rawOg : `/${rawOg}`}`;
---

<!-- BaseHead -->
<title>{title}</title>
<meta name="description" content={description} />
<link rel="canonical" href={canonical} />

<!-- Favicons (match files in /public) -->
<link rel="icon" href="/icon.png?v=2" sizes="any" />
<link rel="icon" href="/PTSicon.png?v=2" type="image/png" />
<link rel="apple-touch-icon" href="/icon.png?v=2" />
<meta name="theme-color" content="#0f0f0f" />

<!-- Open Graph -->
<meta property="og:type" content={articleDate ? "article" : "website"} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:url" content={canonical} />
<meta property="og:site_name" content={siteConfig.title} />
<meta property="og:locale" content={siteConfig.ogLocale ?? "en_US"} />
<meta property="og:image" content={ogPath} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
{articleDate && <meta property="article:published_time" content={articleDate} />}

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={ogPath} />

<!-- Optional: sitemap/rss if you actually generate them -->
<link rel="sitemap" type="application/xml" href="/sitemap-index.xml" />
<link rel="alternate" type="application/rss+xml" title="Blog" href="/rss.xml" />
