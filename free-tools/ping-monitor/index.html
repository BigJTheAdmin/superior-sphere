<!DOCTYPE html><html class="scroll-smooth" lang="en-US" data-astro-cid-5hce7sga> <head><!-- Keep charset FIRST to prevent mojibake like Ã¢â‚¬â„¢ --><meta charset="utf-8"><!-- Mobile default at ~75% scale (no pinch-zoom needed) --><meta name="viewport" content="width=device-width, initial-scale=0.75, viewport-fit=cover"><!-- Helpful mobile/browser theming --><meta name="theme-color" content="#0b0f14"><meta name="color-scheme" content="dark light"><meta name="format-detection" content="telephone=no"><!-- Your existing head (title, SEO, OG tags, etc.) --><!-- BaseHead --><title>Ping Monitor</title><meta name="description" content="Networking tools, automation, and troubleshooting for IT professionals."><link rel="canonical" href="https://pingtracessh.com/free-tools/ping-monitor/"><!-- Favicons (match files in /public) --><link rel="icon" href="/icon.png?v=2" sizes="any"><link rel="icon" href="/PTSicon.png?v=2" type="image/png"><link rel="apple-touch-icon" href="/icon.png?v=2"><meta name="theme-color" content="#0f0f0f"><!-- Open Graph --><meta property="og:type" content="website"><meta property="og:title" content="Ping Monitor"><meta property="og:description" content="Networking tools, automation, and troubleshooting for IT professionals."><meta property="og:url" content="https://pingtracessh.com/free-tools/ping-monitor/"><meta property="og:site_name" content="Ping.Trace.SSH"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://pingtracessh.com/"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><!-- Twitter --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Ping Monitor"><meta name="twitter:description" content="Networking tools, automation, and troubleshooting for IT professionals."><meta name="twitter:image" content="https://pingtracessh.com/"><!-- Optional: sitemap/rss if you actually generate them --><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Blog" href="/rss.xml"><!-- Mobile-safe baseline that wonâ€™t fight Tailwind --><link rel="stylesheet" href="/_astro/_slug_.BJY2hdSo.css">
<style>:root{--card-bg:#1e1e1e;--card-br:#333;--muted:#9aa0a6}.wrap[data-astro-cid-tn2exmmu]{display:flex;flex-direction:column;gap:24px;margin-top:14px}.row[data-astro-cid-tn2exmmu]{display:grid;grid-template-columns:minmax(0,1fr) minmax(0,1fr);gap:16px}@media (max-width:1000px){.row[data-astro-cid-tn2exmmu]{grid-template-columns:minmax(0,1fr)}}.card[data-astro-cid-tn2exmmu]{background:var(--card-bg);border:1px solid var(--card-br);border-radius:12px;padding:16px}.controls-grid[data-astro-cid-tn2exmmu]{display:grid;grid-template-columns:repeat(12,1fr);gap:10px;align-items:end}.controls-grid[data-astro-cid-tn2exmmu]>div[data-astro-cid-tn2exmmu]{display:flex;flex-direction:column;gap:6px;min-width:0}.controls-grid[data-astro-cid-tn2exmmu] label[data-astro-cid-tn2exmmu]{font-size:.85rem;color:var(--muted)}input[data-astro-cid-tn2exmmu][type=text],input[data-astro-cid-tn2exmmu][type=number],select[data-astro-cid-tn2exmmu]{background:#121212;color:#e5e7eb;border:1px solid #2e2e2e;border-radius:8px;padding:10px 12px;outline:none;min-width:0}button[data-astro-cid-tn2exmmu]{background:#2563eb;color:#fff;border:none;border-radius:10px;padding:12px 16px;cursor:pointer;transition:background .15s}button[data-astro-cid-tn2exmmu].secondary{background:#374151}button[data-astro-cid-tn2exmmu].ghost{background:transparent;border:1px solid #3a3a3a}button[data-astro-cid-tn2exmmu]:disabled{opacity:.6;cursor:not-allowed}button[data-astro-cid-tn2exmmu]:hover{background:#1d4ed8}.badge[data-astro-cid-tn2exmmu]{display:inline-flex;align-items:center;gap:6px;border-radius:999px;padding:4px 10px;font-size:.8rem;background:#0f172a;border:1px solid #223;color:#cbd5e1}.targets[data-astro-cid-tn2exmmu]{display:flex;flex-direction:column;gap:10px;margin-top:10px}.target-row[data-astro-cid-tn2exmmu]{display:grid;gap:8px;align-items:center;grid-template-columns:16px 120px minmax(0,1fr) 160px minmax(0,220px) 36px}@media (max-width:900px){.target-row[data-astro-cid-tn2exmmu]{grid-template-columns:16px 120px minmax(0,1fr) 120px minmax(0,1fr) 36px}}.chip[data-astro-cid-tn2exmmu]{width:12px;height:12px;border-radius:3px;border:1px solid #222}.legend[data-astro-cid-tn2exmmu]{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}.legend[data-astro-cid-tn2exmmu] .item[data-astro-cid-tn2exmmu]{display:inline-flex;align-items:center;gap:6px;font-size:.85rem;color:#e5e7eb;background:#121212;border:1px solid #2b2b2b;padding:4px 8px;border-radius:8px;cursor:pointer;opacity:.95}.legend[data-astro-cid-tn2exmmu] .item[data-astro-cid-tn2exmmu].inactive{opacity:.35}.legend[data-astro-cid-tn2exmmu] .dot[data-astro-cid-tn2exmmu]{width:10px;height:10px;border-radius:50%;background:#60a5fa;border:1px solid #1c1c1c}.chartbox[data-astro-cid-tn2exmmu]{height:320px;border:1px dashed #2a2a2a;border-radius:10px;overflow:hidden;background:#0b0b0b}#chart[data-astro-cid-tn2exmmu]{display:block;width:100%;height:320px}.stats[data-astro-cid-tn2exmmu]{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:8px;margin-top:8px}.stat[data-astro-cid-tn2exmmu]{background:#121212;border:1px solid #2b2b2b;border-radius:10px;padding:10px;font-size:.95rem;word-break:break-word}.stat[data-astro-cid-tn2exmmu] b[data-astro-cid-tn2exmmu]{display:flex;align-items:center;gap:6px;color:#cbd5e1;font-weight:600;margin-bottom:6px;font-size:.85rem}.stat[data-astro-cid-tn2exmmu] .sw[data-astro-cid-tn2exmmu]{width:10px;height:10px;border-radius:3px;border:1px solid #1c1c1c;display:inline-block}.small[data-astro-cid-tn2exmmu]{font-size:.85rem;color:var(--muted)}.guide[data-astro-cid-tn2exmmu]{line-height:1.55;margin-top:6px}.guide[data-astro-cid-tn2exmmu] code[data-astro-cid-tn2exmmu]{background:#0f172a;border:1px solid #223;padding:1px 6px;border-radius:6px}.warn[data-astro-cid-tn2exmmu]{color:#f59e0b}.del[data-astro-cid-tn2exmmu]{background:#2a2a2a;border-radius:8px;height:37px;display:inline-flex;align-items:center;justify-content:center}
</style><script type="module" src="/_astro/page.V2R8AmkL.js"></script></head> <body class="bg-global-bg text-global-text flex min-h-screen flex-col px-4 pt-6 font-mono text-sm font-normal antialiased sm:px-8" data-astro-cid-5hce7sga> <script>
	const lightModePref = window.matchMedia("(prefers-color-scheme: light)");

	function getUserPref() {
		const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
		return storedTheme || (lightModePref.matches ? "light" : "dark");
	}

	function setTheme(newTheme) {
		if (newTheme !== "light" && newTheme !== "dark") {
			return console.warn(
				`Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
			);
		}

		const root = document.documentElement;

		// root already set to newTheme, exit early
		if (newTheme === root.getAttribute("data-theme")) {
			return;
		}

		root.setAttribute("data-theme", newTheme);

		if (typeof localStorage !== "undefined") {
			localStorage.setItem("theme", newTheme);
		}
	}

	// initial setup
	setTheme(getUserPref());

	// View Transitions hook to restore theme
	document.addEventListener("astro:after-swap", () => setTheme(getUserPref()));

	// listen for theme-change custom event, fired in src/components/ThemeToggle.astro
	document.addEventListener("theme-change", (e) => {
		setTheme(e.detail.theme);
	});

	// listen for prefers-color-scheme change.
	lightModePref.addEventListener("change", (e) => setTheme(e.matches ? "light" : "dark"));
</script> <a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">skip to content
</a> <header class="group relative mb-8 flex w-full items-center sm:ps-18" id="main-header"> <!-- Left: Logo + Nav --> <div class="sm:flex-column flex flex-col items-center sm:items-center"> <a aria-current="false" class="inline-flex items-center sm:relative sm:inline-block" href="/"> <img src="/PTSwTerminalHORIZONTAL.png" alt="PingTraceSSH Logo" class="me-3 h-24 w-auto sm:h-45" loading="eager" decoding="async"> </a> <nav aria-label="Main menu" class="bg-global-bg/85 text-accent absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md py-4 shadow backdrop-blur-sm group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none" id="navigation-menu"> <a aria-current="false" class="px-4 py-4 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/"> Home </a><a aria-current="false" class="px-4 py-4 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/services/"> Services </a><a aria-current="false" class="px-4 py-4 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/career/"> Career Tools </a><a aria-current="false" class="px-4 py-4 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/free-tools/"> Networking Tools </a><a aria-current="false" class="px-4 py-4 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/breakroom/"> Breakroom </a><a aria-current="false" class="px-4 py-4 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/about/"> About </a> </nav> </div> <!-- Right: Search + Donate (pushed fully right) --> <div class="ms-auto flex items-center gap-4 shrink-0"> <a href="https://buy.stripe.com/fZu8wQ3MMaeH60O5R79k40f" class="inline-flex items-center" aria-label="Donate"> <img src="/donate2.png" alt="Donate" class="h-50 w-auto cursor-pointer transition-transform hover:scale-125" loading="lazy" decoding="async"> </a> <site-search class="ms-auto" id="search"> <button class="hover:text-accent flex h-9 w-9 cursor-pointer items-center justify-center rounded-md" aria-keyshortcuts="Control+K Meta+K" data-open-modal disabled> <!-- Magnifying glass --> <svg aria-hidden="true" class="h-7 w-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"> <path d="M0 0h24v24H0z" stroke="none"></path> <circle cx="11" cy="11" r="7"></circle> <path d="M21 21l-6-6"></path> </svg> <span class="sr-only">Open Search</span> </button> <dialog aria-label="search" class="bg-global-bg h-full max-h-full w-full max-w-full border border-zinc-400 shadow-sm backdrop:backdrop-blur-sm open:flex sm:mx-auto sm:mt-16 sm:mb-auto sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md"> <div class="dialog-frame flex grow flex-col gap-4 p-6 pt-12 sm:pt-6"> <button class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700" data-close-modal>Close</button> <!-- SEARCH INPUT + RESULTS (replaces pagefind UI) --> <div class="flex flex-col gap-3"> <div class="relative"> <span class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 opacity-70"> <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"> <circle cx="11" cy="11" r="7"></circle> <line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </span> <input id="pts-search-input" type="search" placeholder="Search pagesâ€¦" class="w-full rounded-md border border-zinc-400 bg-transparent py-2 pl-9 pr-9 outline-none focus:border-accent" autocomplete="off" aria-controls="pts-search-results"> <button id="pts-search-clear" class="absolute right-2 top-1/2 -translate-y-1/2 rounded p-1 opacity-70 hover:opacity-100" title="Clear" aria-label="Clear" hidden> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"> <line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line> </svg> </button> </div> <div id="pts-search-results" role="listbox" class="max-h-[50vh] overflow-auto rounded-md border border-zinc-400"> <!-- results render here --> </div> </div> </div> </dialog> </site-search> <script type="module">class p extends HTMLElement{#n;#e;#r;#o;#t;#s=[];#l=!1;constructor(){super(),this.#o=this.querySelector("button[data-open-modal]"),this.#n=this.querySelector("button[data-close-modal]"),this.#e=this.querySelector("dialog"),this.#r=this.querySelector(".dialog-frame"),this.#t=new AbortController,this.#o?(this.#o.addEventListener("click",this.openModal),this.#o.disabled=!1):console.warn("Search button not found"),this.#n?this.#n.addEventListener("click",this.closeModal):console.warn("Close button not found"),this.#e?this.#e.addEventListener("close",()=>{window.removeEventListener("click",this.onWindowClick)}):console.warn("Dialog not found")}connectedCallback(){window.addEventListener("keydown",this.onWindowKeydown,{signal:this.#t.signal}),(window.requestIdleCallback||(t=>setTimeout(t,1)))(()=>this.#a())}disconnectedCallback(){this.#t.abort()}openModal=e=>{if(!this.#e)return;this.#e.showModal(),this.querySelector("#pts-search-input")?.focus(),e?.stopPropagation(),window.addEventListener("click",this.onWindowClick,{signal:this.#t.signal}),this.#i(this.#s.slice(0,10))};closeModal=()=>this.#e?.close();onWindowClick=e=>{("href"in(e.target||{})||document.body.contains(e.target)&&!this.#r?.contains(e.target))&&this.closeModal()};onWindowKeydown=e=>{this.#e&&(e.metaKey===!0||e.ctrlKey===!0)&&e.key==="k"&&(this.#e.open?this.closeModal():this.openModal(),e.preventDefault())};async#a(){if(!this.#l)try{const e=await fetch("/api/pages-search.json",{cache:"force-cache"});if(!e.ok)throw new Error("Failed to fetch page index");this.#s=await e.json()}catch(e){console.error(e),this.#s=[]}finally{this.#l=!0,this.#c()}}#c(){const e=this.querySelector("#pts-search-input"),t=this.querySelector("#pts-search-clear");if(!e)return;const i=()=>{const r=e.value.trim().toLowerCase();if(!r){this.#i(this.#s.slice(0,10)),t&&(t.hidden=!0);return}t&&(t.hidden=!1);const l=r.split(/\s+/).filter(Boolean),a=s=>{let o=0;const d=(s.title||"").toLowerCase(),h=(s.description||"").toLowerCase(),u=(s.keywords||[]).map(n=>(n||"").toLowerCase());for(const n of l)d.includes(n)&&(o+=3),u.some(f=>f.includes(n))&&(o+=2),h.includes(n)&&(o+=1);return o},c=this.#s.map(s=>({doc:s,s:a(s)})).filter(s=>s.s>0).sort((s,o)=>o.s-s.s).slice(0,50).map(s=>s.doc);this.#i(c)};e.addEventListener("input",i,{signal:this.#t.signal}),e.addEventListener("keydown",r=>{r.key==="Escape"&&(e.value="",t&&(t.hidden=!0),this.#i(this.#s.slice(0,10)))},{signal:this.#t.signal}),t?.addEventListener("click",()=>{e.value="",t.hidden=!0,this.#i(this.#s.slice(0,10)),e.focus()},{signal:this.#t.signal})}#i(e){const t=this.querySelector("#pts-search-results");if(t){if(!e.length){t.innerHTML='<div class="p-3 text-sm opacity-70">No matches. Try different keywords.</div>';return}t.innerHTML=e.map(i=>`
        <a href="${i.url}" role="option" class="block border-b border-zinc-700/40 p-3 hover:bg-accent/10 focus:bg-accent/10 focus:outline-none">
          <div class="font-semibold">${i.title}</div>
          ${i.description?`<div class="mt-0.5 text-sm opacity-80">${i.description}</div>`:""}
        </a>
      `).join("")}}}customElements.define("site-search",p);</script> </div> <!-- Mobile hamburger --> <mobile-button> <button aria-expanded="false" aria-haspopup="menu" class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button"> <span class="sr-only">Open main menu</span> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"> <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path> </svg> <svg aria-hidden="true" class="text-accent absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"> <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </button> </mobile-button> </header> <script type="module">function s(t,e){t.classList.toggle(e)}class l extends HTMLElement{#e=!1;connectedCallback(){const e=document.getElementById("main-header"),n=this.querySelector("button");n?.addEventListener("click",()=>{e&&s(e,"menu-open"),this.#e=!this.#e,n.setAttribute("aria-expanded",this.#e.toString())})}}customElements.define("mobile-button",l);</script> <!-- Live status bar --> <div id="status-ticker-host"></div> <script type="module">
  const host = document.getElementById("status-ticker-host");
  const root = host.attachShadow({ mode: "open" });

  root.innerHTML = `
    <style>
      .ticker-wrapper{overflow:hidden;background:#111;border-bottom:2px solid #333}
      .ticker{display:inline-flex;white-space:nowrap;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:.85rem;padding:.5rem 1rem;gap:3rem;font-weight:700;will-change:transform}
      .lane{display:inline-flex;white-space:nowrap;gap:2rem}
      .chip{display:inline-flex;align-items:center;gap:.5rem;padding:.15rem .5rem;border-radius:9999px;border:1px solid #333;background:#0b0b0b}
      .dot{width:8px;height:8px;border-radius:9999px;box-shadow:0 0 8px currentColor}
      .up{color:#14f195!important}
      .down{color:#ff3b3b!important}
      .checking{color:#ffb020!important}
      .track{position:relative;width:100%;overflow:hidden}
      .rail{display:inline-flex;white-space:nowrap;gap:3rem;animation:scroll linear infinite}
      @keyframes scroll{from{transform:translateX(0)}to{transform:translateX(-50%)}}
      .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0;white-space:nowrap}
    </style>

    <div class="ticker-wrapper" aria-live="polite" aria-atomic="false">
      <div class="track">
        <div id="rail" class="rail">
          <div id="laneA" class="ticker lane">Loadingâ€¦</div>
          <div id="laneB" class="ticker lane">Loadingâ€¦</div>
        </div>
      </div>
      <span id="a11y" class="sr-only"></span>
    </div>
  `;

  const $ = (s)=>root.querySelector(s);
  const laneA = $("#laneA");
  const laneB = $("#laneB");
  const rail  = $("#rail");
  const a11y  = $("#a11y");

  /** CONFIG **/
  // IMPORTANT: On GitHub Pages, files in /public build to the site root.
  // We compute the correct absolute URL whether you're on a custom domain
  // or a subpath (e.g., https://username.github.io/repo/).
  const JSON_FILENAME = "ping-services.json";
  let FETCH_URL = "/ping-services.json";
  try {
    const baseHref = document.querySelector('base')?.getAttribute('href') || "/";
    // new URL(relative, base) handles both "/" and "/repo/" styles
    FETCH_URL = new URL(JSON_FILENAME, new URL(baseHref, location.origin)).toString();
  } catch { /* noop; fallback stays "/ping-services.json" */ }

  const BASE_POLL_MS = 30_000;
  const POLL_JITTER_MS = 5_000;
  const FETCH_TIMEOUT_MS = 12_000;           // backend sometimes slow
  const PX_PER_SEC = 90;
  const DATA_STALE_MS = 3 * 60_000;          // too old to trust
  const DATA_FRESH_MS = 75_000;              // fresh enough to infer UP if no fails
  const REQUIRE_CONSEC_FAILS = 2;            // confirm DOWN
  const LOCAL_CACHE_KEY = "pts_status_ticker_cache_v4";
  const STATE_CACHE_KEY = "pts_status_ticker_state_v4";

  const renderCache = loadJson(LOCAL_CACHE_KEY) || { items: [], ts: 0 };
  const stateCache  = loadJson(STATE_CACHE_KEY)  || {}; // { [name]: {state,lastTs} }

  // Instant paint from cache (prevents empty bar on first load)
  if (renderCache.items?.length) {
    render(renderCache.items); autosizeScroller();
  }

  // Poll with jitter
  let pollTimer=null;
  const tick = async()=>{ await update(); scheduleNext(); };
  scheduleNext(true);
  function scheduleNext(immediate=false){
    if(pollTimer) clearTimeout(pollTimer);
    if(immediate) return void tick();
    const j=(Math.random()*2-1)*POLL_JITTER_MS;
    pollTimer=setTimeout(tick, BASE_POLL_MS+j);
  }

  document.addEventListener("visibilitychange", ()=> {
    rail.style.animationPlayState = document.hidden ? "paused" : "running";
  });
  new ResizeObserver(()=>autosizeScroller()).observe(rail);

  /** fetch with timeout + one retry */
  async function fetchJson() {
    const once = async () => {
      const controller = new AbortController();
      const timer = setTimeout(()=>controller.abort(), FETCH_TIMEOUT_MS);
      try {
        const res = await fetch(FETCH_URL, { cache: "no-store", signal: controller.signal });
        if (!res.ok) throw new Error(`HTTP ${res.status} at ${FETCH_URL}`);
        return await res.json();
      } finally { clearTimeout(timer); }
    };
    try { return await once(); }
    catch(e){
      console.warn("[StatusTicker] fetch failed, retrying:", e?.message||e);
      try { return await once(); }
      catch(e2){
        console.warn("[StatusTicker] second fetch failed, using cache:", e2?.message||e2);
        // fall back to last known good data if we have it
        if (renderCache.items?.length) return renderCache.items;
        throw e2;
      }
    }
  }

  async function update(){
    let data;
    try { data = await fetchJson(); }
    catch { return; } // keep last good

    const arr = Array.isArray(data) ? data : (data?.results ?? data ?? []);
    if (!Array.isArray(arr) || !arr.length) return;

    const cooked = postProcess(arr);
    if (!cooked.length) return;

    render(cooked); autosizeScroller();
    saveJson(LOCAL_CACHE_KEY, { items: cooked, ts: Date.now() });

    const downs=cooked.filter(i=>i.state==="down");
    a11y.textContent = downs.length ? `${downs.length} services down: ${downs.map(d=>d.name).join(", ")}`
                                    : `All services up (${cooked.length})`;
  }

  function postProcess(raw){
    const now=Date.now();
    const list = raw.map(r=>normalizeOne(r,now)).filter(Boolean).filter(i=>!i.isStale).map(applyOptimistic);

    // persist last known
    for(const i of list){ stateCache[i.name]={state:i.state,lastTs:i.lastTs}; }
    saveJson(STATE_CACHE_KEY,stateCache);

    // down -> up -> checking
    const order={down:0,up:1,checking:2};
    list.sort((a,b)=> order[a.state]-order[b.state] || a.name.localeCompare(b.name));
    return list;
  }

  function normalizeOne(r, now){
    const name=String(r.name ?? r.service ?? r.id ?? "").trim();
    if(!name) return null;

    const lastTs = toMs(r.lastSeen) ?? toMs(r.lastUpdate) ?? toMs(r.checkedAt) ?? toMs(r.timestamp) ?? now;
    const age = now - lastTs;
    const isStale = age > DATA_STALE_MS;
    const isFresh = age <= DATA_FRESH_MS;

    const explicitUp   = asBool(r.up) || asBool(r.ok) || r.status===200 || String(r.status||"").startsWith("2");
    const explicitDown = asBool(r.down) || String(r.state||"").toLowerCase()==="down" ||
                         String(r.health||"").toLowerCase()==="unhealthy" || String(r.status||"").startsWith("5");

    const fails = Number(r.consecutiveFails ?? r.failures ?? r.consecutive_failures ?? 0) || 0;

    return {
      name, lastTs, isStale, isFresh, explicitUp, explicitDown, fails,
      latencyMs: numOrNull(r.latencyMs ?? r.rtt ?? r.latency),
      region: r.region ?? r.pop ?? null,
      state: explicitUp ? "up" : (explicitDown ? "down" : "checking"),
    };
  }

  // **Key inference**
  // - Explicit UP => UP
  // - Explicit DOWN (fresh) => DOWN if fails >= threshold (or counter missing)
  // - Otherwise:
  //     if sample is FRESH and fails==0 => infer UP (prevents â€œstuck CHECKINGâ€)
  //     else keep last known UP if not stale
  //     else CHECKING
  function applyOptimistic(i){
    const cached = stateCache[i.name];

    if(i.explicitUp){ i.state="up"; return i; }
    if(i.explicitDown && !i.isStale){
      if(i.fails>=REQUIRE_CONSEC_FAILS || i.fails===0){ i.state="down"; return i; }
      i.state="checking"; return i;
    }
    if(i.isFresh && i.fails===0){ i.state="up"; return i; }

    if(cached){
      const recent = (Date.now()-(cached.lastTs||0)) <= DATA_STALE_MS;
      if(recent && cached.state==="up"){ i.state="up"; return i; }
      if(recent && cached.state==="down"){ i.state="down"; return i; }
    }
    i.state="checking"; return i;
  }

  function render(items){
    const row = items.map(chip).join("");
    laneA.innerHTML=row; laneB.innerHTML=row;
  }

  function chip(i){
    const cls=i.state;
    const label= i.state==="up"?"UP":(i.state==="down"?"DOWN":"CHECKING");
    const title=[`${i.name} â€” ${label}`,
      i.latencyMs!=null?`Latency: ${Math.round(i.latencyMs)} ms`:null,
      i.region?`Region: ${i.region}`:null,
      i.lastTs?`Updated: ${new Date(i.lastTs).toLocaleString()}`:null
    ].filter(Boolean).join(" â€¢ ");
    return `<span class="chip ${cls}" title="${escapeHtml(title)}"><span class="dot ${cls}" aria-hidden="true"></span><span class="label">${escapeHtml(i.name)}: ${label}</span></span>`;
  }

  function autosizeScroller(){
    const wrapW = root.host.getBoundingClientRect().width || 1;
    ensureWidth(laneA,wrapW); ensureWidth(laneB,wrapW);
    const laneW = laneA.scrollWidth || 600;
    const dur = Math.max(8, Math.round(laneW / PX_PER_SEC));
    rail.style.animationDuration = `${dur}s`;
  }
  function ensureWidth(lane,wrapW){
    const minW=Math.max(wrapW,600); let guard=0;
    while(lane.scrollWidth<minW && guard<8){ lane.innerHTML += lane.innerHTML; guard++; }
  }

  // utils
  function asBool(v){ if(typeof v==="boolean")return v; if(typeof v==="number")return v>0; if(typeof v==="string")return ["ok","up","true","healthy","success"].includes(v.toLowerCase()); return false; }
  function toMs(v){ if(v==null) return null; if(typeof v==="number") return v>1e12?v:v*1000; const d=new Date(v); return isNaN(d)?null:d.getTime(); }
  function numOrNull(v){ const n=Number(v); return Number.isFinite(n)?n:null; }
  function escapeHtml(s){ return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"); }
  function loadJson(k){ try{ return JSON.parse(localStorage.getItem(k)||"null"); }catch{ return null; } }
  function saveJson(k,o){ try{ localStorage.setItem(k, JSON.stringify(o)); }catch{} }
</script> <!-- Main site content --> <main id="main" class="flex-1" data-astro-cid-5hce7sga>  <h1 data-astro-cid-tn2exmmu>Ping Monitor â€” Browser + Edge</h1> <p data-astro-cid-tn2exmmu>
Measure round-trip time from your <em data-astro-cid-tn2exmmu>browser</em> (WebSocket/HTTP) and from the <em data-astro-cid-tn2exmmu>edge</em> (Cloudflare Worker) for any IP/port.
    Compare latency, jitter, and loss across multiple targets.
</p>  <div class="wrap" data-astro-cid-tn2exmmu> <!-- Controls --> <div class="card" data-astro-cid-tn2exmmu> <div class="controls-grid" data-astro-cid-tn2exmmu> <div style="grid-column:span 2" data-astro-cid-tn2exmmu> <label for="count" data-astro-cid-tn2exmmu>Total Pings</label> <input id="count" type="number" min="1" max="99999" value="50" data-astro-cid-tn2exmmu> </div> <div style="grid-column:span 2" data-astro-cid-tn2exmmu> <label for="interval" data-astro-cid-tn2exmmu>Interval (ms)</label> <input id="interval" type="number" min="50" step="50" value="1000" data-astro-cid-tn2exmmu> <small class="small" data-astro-cid-tn2exmmu>Time between batches</small> </div> <div style="grid-column:span 2" data-astro-cid-tn2exmmu> <label for="batch" data-astro-cid-tn2exmmu>Batch Size</label> <input id="batch" type="number" min="1" max="20" value="5" data-astro-cid-tn2exmmu> <small class="small" data-astro-cid-tn2exmmu>RTT samples per Worker call (Edge IP)</small> </div> <div style="grid-column:span 2" data-astro-cid-tn2exmmu> <label for="timeout" data-astro-cid-tn2exmmu>Timeout (ms)</label> <input id="timeout" type="number" min="100" step="100" value="3000" data-astro-cid-tn2exmmu> </div> <div style="grid-column:span 2" data-astro-cid-tn2exmmu> <label data-astro-cid-tn2exmmu>&nbsp;</label> <button id="startBtn" data-astro-cid-tn2exmmu>Start</button> </div> <div style="grid-column:span 2" data-astro-cid-tn2exmmu> <label data-astro-cid-tn2exmmu>&nbsp;</label> <button id="stopBtn" class="secondary" disabled data-astro-cid-tn2exmmu>Stop</button> </div> </div> <hr style="border:0;border-top:1px solid #2b2b2b;margin:14px 0" data-astro-cid-tn2exmmu> <!-- Targets --> <div data-astro-cid-tn2exmmu> <div class="badge" data-astro-cid-tn2exmmu>Targets</div> <div id="targets" class="targets" data-astro-cid-tn2exmmu></div> <!-- Add Target Row --> <div class="target-row" style="margin-top:8px" data-astro-cid-tn2exmmu> <span class="chip" style="background:#444" data-astro-cid-tn2exmmu></span> <select id="newType" data-astro-cid-tn2exmmu> <option value="ws" data-astro-cid-tn2exmmu>WebSocket</option> <option value="http" data-astro-cid-tn2exmmu>HTTP</option> <option value="edge" data-astro-cid-tn2exmmu>Edge IP</option> </select> <input id="newUrl" type="text" placeholder="Example: wss://echo.websocket.events  |  https://postman-echo.com/get  |  8.8.8.8:443" data-astro-cid-tn2exmmu> <select id="newProto" title="Protocol for Edge IP (ignored for WS/HTTP)" data-astro-cid-tn2exmmu> <option value="https" selected data-astro-cid-tn2exmmu>https</option> <option value="http" data-astro-cid-tn2exmmu>http</option> </select> <input id="newLabel" type="text" placeholder="Label (optional)" data-astro-cid-tn2exmmu> <button id="addBtn" class="ghost" title="Add target" data-astro-cid-tn2exmmu>ï¼‹</button> </div> <p class="guide" data-astro-cid-tn2exmmu> <b data-astro-cid-tn2exmmu>Parameter Guide</b> â€” <b data-astro-cid-tn2exmmu>Total Pings</b>: measurements to collect per target (timeouts count). <b data-astro-cid-tn2exmmu>Interval</b>: delay between batches (ms).<br data-astro-cid-tn2exmmu> <b data-astro-cid-tn2exmmu>Batch Size</b>: <em data-astro-cid-tn2exmmu>Edge IP only</em> â€” RTT samples returned per Worker call. <b data-astro-cid-tn2exmmu>Timeout</b>: per-sample timeout before counting as loss.<br data-astro-cid-tn2exmmu> <b data-astro-cid-tn2exmmu>WebSocket</b>: echo RTT via WS (e.g., <code data-astro-cid-tn2exmmu>wss://echo.websocket.events</code>). <b data-astro-cid-tn2exmmu>HTTP</b>: browser fetch timing (subject to CORS).<br data-astro-cid-tn2exmmu> <b data-astro-cid-tn2exmmu>Edge IP</b>: probe <code data-astro-cid-tn2exmmu>IP/host[:port]</code> from Cloudflareâ€™s edge via HTTP/HTTPS (not ICMP).
</p> <p id="edgeWarn" class="warn" style="margin-top:6px;display:none" data-astro-cid-tn2exmmu>
Edge Ping URL not configured â€” Edge IP targets will not run. Set <code data-astro-cid-tn2exmmu>EDGE_PING_URL</code> in this file.
</p> </div> </div> <!-- Charts & Stats --> <div class="row" data-astro-cid-tn2exmmu> <div class="card" data-astro-cid-tn2exmmu> <div class="badge" data-astro-cid-tn2exmmu>Latency (ms)</div> <div id="chartBox" class="chartbox" data-astro-cid-tn2exmmu> <canvas id="chart" data-astro-cid-tn2exmmu></canvas> </div> <div id="legend" class="legend" data-astro-cid-tn2exmmu></div> </div> <div class="card" data-astro-cid-tn2exmmu> <div class="badge" data-astro-cid-tn2exmmu>Stats</div> <div id="stats" class="stats" data-astro-cid-tn2exmmu></div> <p class="small" style="margin-top:8px" data-astro-cid-tn2exmmu>Jitter = std dev of successful RTT samples. Loss = timeouts / total attempts.</p> </div> </div> </div> <script type="module">
    /********* CONFIG *********/
    const EDGE_PING_URL = ""; // e.g., "https://edge-ping.pingtracessh.com"
    if (!EDGE_PING_URL) document.getElementById("edgeWarn").style.display = "block";

    /********* COLORS *********/
    const COLORS=["#60a5fa","#34d399","#f472b6","#f59e0b","#22d3ee","#c084fc","#fb7185","#a3e635","#f97316","#2dd4bf","#e879f9","#93c5fd"];
    const pickColor=(i)=>COLORS[i%COLORS.length];

    /********* DOM *********/
    const targetsEl=document.getElementById("targets");
    const legendEl=document.getElementById("legend");
    const statsEl=document.getElementById("stats");
    const chartBox=document.getElementById("chartBox");
    const chartCanvas=document.getElementById("chart");
    const ctx=chartCanvas.getContext("2d");

    const startBtn=document.getElementById("startBtn");
    const stopBtn=document.getElementById("stopBtn");
    const countEl=document.getElementById("count");
    const intEl=document.getElementById("interval");
    const toEl=document.getElementById("timeout");
    const batchEl=document.getElementById("batch");

    const addBtn=document.getElementById("addBtn");
    const newType=document.getElementById("newType");
    const newUrl=document.getElementById("newUrl");
    const newProto=document.getElementById("newProto");
    const newLabel=document.getElementById("newLabel");

    /********* STATE *********/
    let running=false, tickTimer=null, activeSeriesId=null;
    /** { id,type,url,label,color,data:(number|null)[], ws?, pending?, edge?:{host,port,proto} } */
    let series=[];

    /********* UTIL *********/
    const clamp=(n,lo,hi)=>Math.min(hi,Math.max(lo,isFinite(n)?n:lo));
    const escapeHtml=(s)=>(s+"").replace(/[&<>\"']/g,c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c]));
    function stddev(arr,mean){ if(!arr.length) return 0;
      const m=(typeof mean==="number")?mean:(arr.reduce((a,b)=>a+b,0)/arr.length);
      return Math.sqrt(arr.reduce((acc,x)=>acc+Math.pow(x-m,2),0)/arr.length);
    }
    function parseHostPort(v){
      let host=v.trim(),port=null;
      if(!host) return {host:"",port:null};
      if(host.includes("]:")){const m=/^\[([^\]]+)\]:(\d+)$/.exec(host); if(m){host=m[1];port=+m[2];}}
      else if(host.includes(":") && host.indexOf(":")===host.lastIndexOf(":")){const [h,p]=host.split(":");host=h;port=+p;}
      return {host,port:port||null};
    }
    function normalizeInput(type, raw, proto){
      let v=raw.trim();
      if(type==="ws"){
        if(!/^wss?:\/\//i.test(v)) v="wss://"+v.replace(/^\/+/,"");
      }else if(type==="http"){
        if(!/^https?:\/\//i.test(v)) v="https://"+v.replace(/^\/+/,"");
      }else{ /* edge */ v=v; }
      return v;
    }

    /********* TARGET UI *********/
    function seriesLabel(s){
      if(s.type==="edge") return `${s.edge.host}${s.edge.port?":"+s.edge.port:""} (${s.edge.proto||"https"})`;
      return s.label || s.url || "target";
    }
    function renderTargets(){
      targetsEl.innerHTML="";
      series.forEach((s,idx)=>{
        const row=document.createElement("div"); row.className="target-row";
        row.innerHTML=`
          <span class="chip" style="background:${s.color}"></span>
          <select data-k="type">
            <option value="ws"${s.type==="ws"?" selected":""}>WebSocket</option>
            <option value="http"${s.type==="http"?" selected":""}>HTTP</option>
            <option value="edge"${s.type==="edge"?" selected":""}>Edge IP</option>
          </select>
          <input data-k="url" type="text" value="${s.type==="edge" ? (s.edge.host + (s.edge.port?":"+s.edge.port:"")) : s.url}">
          <select data-k="extra" ${s.type==="edge"?"":"style='display:none;'"} title="Protocol (Edge IP)">
            <option value="https"${s.edge?.proto!=="http"?" selected":""}>https</option>
            <option value="http"${s.edge?.proto==="http"?" selected":""}>http</option>
          </select>
          <input data-k="label" type="text" value="${escapeHtml(s.label||"")}" placeholder="Label (optional)" />
          <button class="del" title="Remove">âœ•</button>
        `;
        row.querySelector('[data-k="type"]').addEventListener("change",(e)=>{
          s.type=e.target.value;
          if(s.type!=="ws" && s.ws){try{s.ws.close();}catch{}; s.ws=null;}
          row.querySelector('[data-k="extra"]').style.display = s.type==="edge" ? "" : "none";
          if(s.type==="edge" && !s.edge) s.edge={host:s.url,port:null,proto:"https"};
          renderLegend(); renderStats(); drawChart();
        });
        row.querySelector('[data-k="url"]').addEventListener("change",(e)=>{
          const v=e.target.value.trim();
          if(s.type==="edge"){ const {host,port}=parseHostPort(v); s.edge.host=host; s.edge.port=port; }
          else { s.url=v; if(s.ws){try{s.ws.close();}catch{}; s.ws=null;} }
          renderLegend(); renderStats(); drawChart();
        });
        row.querySelector('[data-k="extra"]').addEventListener("change",(e)=>{ if(s.type==="edge") s.edge.proto=e.target.value; });
        row.querySelector('[data-k="label"]').addEventListener("change",(e)=>{ s.label=e.target.value.trim()||""; renderLegend(); renderStats(); drawChart(); });
        row.querySelector(".del").addEventListener("click",()=>{
          if(running) stop(); if(s.ws){try{s.ws.close();}catch{};}
          series.splice(idx,1); renderTargets(); renderLegend(); renderStats(); drawChart();
        });
        targetsEl.appendChild(row);
      });
    }
    function renderLegend(){
      legendEl.innerHTML="";
      series.forEach((s)=>{
        const it=document.createElement("div");
        it.className="item"+(activeSeriesId && activeSeriesId!==s.id?" inactive":"");
        it.dataset.id=s.id;
        it.innerHTML=`<span class="dot" style="background:${s.color}"></span>${escapeHtml(s.label||seriesLabel(s))}`;
        it.addEventListener("click",()=>{ activeSeriesId=(activeSeriesId===s.id?null:s.id); renderLegend(); drawChart(); });
        legendEl.appendChild(it);
      });
    }
    function renderStats(){
      statsEl.innerHTML="";
      series.forEach((s)=>{
        const vals=s.data.filter(v=>typeof v==="number");
        const n=s.data.length, ok=vals.length, lost=Math.max(0,n-ok), lossPct=n?(lost/n*100):0;
        const min=ok?Math.min(...vals):0, max=ok?Math.max(...vals):0, avg=ok?(vals.reduce((a,b)=>a+b,0)/ok):0, jitter=ok?stddev(vals,avg):0;
        const box=document.createElement("div"); box.className="stat";
        const endpoint=escapeHtml(seriesLabel(s)); const type=s.type.toUpperCase();
        box.innerHTML=`<b><span class="sw" style="background:${s.color}"></span> ${escapeHtml(s.label||endpoint)}</b>
                        <div class="small">${type} â€¢ ${endpoint}</div>
                        <div>Min: ${min.toFixed(1)} ms</div>
                        <div>Avg: ${avg.toFixed(1)} ms</div>
                        <div>Max: ${max.toFixed(1)} ms</div>
                        <div>Jitter: ${jitter.toFixed(1)} ms</div>
                        <div>Loss: ${lossPct.toFixed(1)}% (${lost}/${n})</div>`;
        // Hover a stat to highlight the series
        box.addEventListener("mouseenter",()=>{activeSeriesId=s.id; renderLegend(); drawChart();});
        box.addEventListener("mouseleave",()=>{activeSeriesId=null; renderLegend(); drawChart();});
        statsEl.appendChild(box);
      });
    }

    /********* CHART (responsive) *********/
    function resizeCanvas(){
      const w=chartBox.clientWidth;
      const h=320; // fixed visual height
      chartCanvas.width=w; chartCanvas.height=h;
      drawChart();
    }
    window.addEventListener("resize", resizeCanvas);

    function drawChart(){
      const W=chartCanvas.width,H=chartCanvas.height;
      ctx.clearRect(0,0,W,H);

      // grid
      ctx.save(); ctx.strokeStyle="#222"; ctx.lineWidth=1;
      for(let y=H-0.5;y>=0;y-=40){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(W,y);ctx.stroke();}
      ctx.restore();

      const maxLen=Math.max(1,...series.map(s=>s.data.length));
      const xStep=W/Math.max(1,maxLen-1);
      const all=series.flatMap(s=>s.data.filter(v=>typeof v==="number"));
      const yMax=Math.max(100,Math.ceil((Math.max(10,...all,0))/25)*25);
      const yScale=H/yMax;

      // y labels
      ctx.fillStyle="#8a8a8a"; ctx.font="12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto";
      for(let ms=0;ms<=yMax;ms+=25){const y=H-ms*yScale; ctx.fillText(ms+"ms",6,Math.max(12,y-2));}

      // series lines + end labels
      series.forEach((s)=>{
        const dim=activeSeriesId && activeSeriesId!==s.id;
        ctx.beginPath(); ctx.lineWidth=dim?2:3; ctx.strokeStyle=s.color; ctx.globalAlpha=dim?0.28:1.0;
        let first=true, lastIdx=-1, lastY=0;
        for(let i=0;i<s.data.length;i++){
          const v=s.data[i], x=i*xStep;
          if(typeof v!=="number"){first=true;continue;}
          const y=H-Math.min(v,yMax)*yScale; lastIdx=i; lastY=y;
          if(first){ctx.moveTo(x,y); first=false;} else {ctx.lineTo(x,y);}
        }
        ctx.stroke(); ctx.globalAlpha=1.0;
        // draw end label near last point
        if(lastIdx>=0){
          const x=lastIdx*xStep+6;
          ctx.fillStyle="#000"; ctx.globalAlpha=0.6;
          ctx.fillRect(x-2,lastY-10, ctx.measureText(s.label||seriesLabel(s)).width+10, 18);
          ctx.globalAlpha=1.0;
          ctx.fillStyle=s.color;
          ctx.fillText((s.label||seriesLabel(s)), x+2, Math.max(12,lastY+5));
        }
      });
    }

    /********* DATA FLOW *********/
    function pushSample(s,v){
      s.data.push(v);
      if(s.data.length>5000) s.data.shift();
      renderStats(); drawChart();
    }

    /********* ENGINES *********/
    // WebSocket echo
    function ensureWS(s){
      return new Promise((resolve,reject)=>{
        if(s.ws && s.ws.readyState===1) return resolve();
        if(s.ws){try{s.ws.close();}catch{}; s.ws=null;}
        try{
          s.ws=new WebSocket(s.url);
          s.ws.addEventListener("open",()=>resolve(),{once:true});
          s.ws.addEventListener("error",()=>reject(new Error("WS error")),{once:true});
          s.ws.addEventListener("message",(ev)=>{
            try{
              const payload=typeof ev.data==="string"?JSON.parse(ev.data):null;
              if(payload && payload.__ping && s.pending && s.pending[payload.__ping]){
                const t0=s.pending[payload.__ping]; delete s.pending[payload.__ping]; pushSample(s,performance.now()-t0);
              }else if(typeof ev.data==="string"){
                const m=/^PING:(\d+)$/.exec(ev.data.trim());
                if(m && s.pending && s.pending[m[1]]){const t0=s.pending[m[1]]; delete s.pending[m[1]]; pushSample(s,performance.now()-t0);}
              }
            }catch{}
          });
        }catch{reject(new Error("WS open failed")); }
      });
    }
    async function wsPing(s,timeoutMs){
      s.pending=s.pending||{}; const id=(s.seq=(s.seq||0)+1);
      try{
        await ensureWS(s); s.pending[id]=performance.now(); s.ws.send(JSON.stringify({__ping:id}));
        const t0=performance.now();
        while(performance.now()-t0<timeoutMs){ if(!s.pending[id]) return; await new Promise(r=>setTimeout(r,5)); }
        delete s.pending[id]; pushSample(s,null);
      }catch{pushSample(s,null);}
    }

    // HTTP timing
    async function httpPing(s,timeoutMs){
      const ctrl=new AbortController(); const t0=performance.now();
      const url=/^https?:\/\//i.test(s.url)?s.url:"https://"+s.url;
      const bust=url+(url.includes("?")?"&":"?")+"_cb="+Math.random().toString(36).slice(2);
      const timer=setTimeout(()=>ctrl.abort("timeout"),timeoutMs);
      try{ await fetch(bust,{method:"GET",cache:"no-store",redirect:"follow",signal:ctrl.signal,mode:"cors"});
           clearTimeout(timer); pushSample(s,performance.now()-t0);}
      catch{clearTimeout(timer); pushSample(s,null);}
    }

    // Edge IP (batch)
    async function edgePingBatch(s,timeoutMs){
      if(!EDGE_PING_URL){ pushSample(s,null); return; }
      const batchSize=clamp(+batchEl.value,1,20);
      const q=new URLSearchParams({
        host:s.edge.host, count:String(batchSize), timeout:String(timeoutMs),
        proto:s.edge.proto||"https", port:s.edge.port?String(s.edge.port):""
      });
      try{
        const res=await fetch(`${EDGE_PING_URL}/probe?`+q.toString(),{method:"GET",cache:"no-store"});
        if(!res.ok){ for(let i=0;i<batchSize;i++) pushSample(s,null); return; }
        const j=await res.json();
        if(Array.isArray(j.samples)){ j.samples.forEach(sample=>pushSample(s, sample.ok?sample.rtt:null)); }
        else{ for(let i=0;i<batchSize;i++) pushSample(s,null); }
      }catch{ for(let i=0;i<batchSize;i++) pushSample(s,null); }
    }

    /********* RUNNER *********/
    function resetAll(){ series.forEach(s=>{ s.data=[]; s.seq=0; s.pending={}; if(s.ws){try{s.ws.close();}catch{}; s.ws=null;} }); renderStats(); drawChart(); }
    const allTargetsReached=(total)=> series.length? series.every(s=>s.data.length>=total):true;

    async function step(){
      const timeout=clamp(+toEl.value,100,60000);
      await Promise.all(series.map(s=>{
        if(s.type==="ws") return wsPing(s,timeout);
        if(s.type==="http") return httpPing(s,timeout);
        return edgePingBatch(s,timeout);
      }));
      const total=clamp(+countEl.value,1,99999);
      if(allTargetsReached(total)) stop();
    }

    function start(){
      if(running || series.length===0) return;
      running=true; startBtn.disabled=true; stopBtn.disabled=false;
      resetAll(); step();
      const interval=clamp(+intEl.value,50,600000);
      tickTimer=setInterval(step,interval);
    }
    function stop(){
      running=false; startBtn.disabled=false; stopBtn.disabled=true;
      if(tickTimer){clearInterval(tickTimer); tickTimer=null;}
      series.forEach(s=>{ if(s.ws){try{s.ws.close();}catch{}; s.ws=null;} });
    }

    /********* ADD / DEFAULTS *********/
    function addTarget(type, raw, label, proto="https"){
      const id=crypto.randomUUID(); const color=pickColor(series.length);
      let s;
      if(type==="edge"){ const {host,port}=parseHostPort(raw); s={id,type,url:"",label:(label||"").trim(),color,data:[],edge:{host,port,proto}}; }
      else{ const url=normalizeInput(type,raw,proto); s={id,type,url,label:(label||"").trim(),color,data:[]}; }
      // fallback label
      if(!s.label) s.label = type==="edge" ? `${s.edge.host}${s.edge.port?":"+s.edge.port:""} (${s.edge.proto})` : (s.url);
      series.push(s); renderTargets(); renderLegend(); renderStats(); drawChart(); return s;
    }

    // Sensible defaults (removable)
    addTarget("ws","wss://echo.websocket.events","Echo (Anycast WS)");
    addTarget("http","https://postman-echo.com/get","Postman Echo");
    addTarget("edge","1.1.1.1:443","Cloudflare 1.1.1.1:443","https");

    addBtn.addEventListener("click",()=>{
      const t=newType.value, u=newUrl.value.trim(), p=newProto.value, L=newLabel.value.trim();
      if(!u) return;
      addTarget(t,u,L,p); newUrl.value=""; newLabel.value="";
    });
    // Press Enter in URL field to add
    newUrl.addEventListener("keydown",(e)=>{ if(e.key==="Enter"){ e.preventDefault(); addBtn.click(); } });

    startBtn.addEventListener("click",start);
    stopBtn.addEventListener("click",stop);
    window.addEventListener("beforeunload",stop);

    // Initial sizing
    resizeCanvas();
    // Slight delay to avoid 0-width in some SSR hydration cases
    setTimeout(resizeCanvas, 50);
  </script>  </main> <footer class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pt-10 pb-4 text-center align-top font-semibold text-gray-600 sm:flex-row sm:justify-between sm:text-xs dark:text-gray-400"> <div class="me-0 sm:me-4">
&copy; J The Admin 2025.<span class="inline-block">&nbsp;ðŸš€&nbsp;Ping.Trace.SSH</span> </div> <!-- Hidden on mobile, shown from md and up --> <nav aria-labelledby="footer_links" class="hidden md:flex gap-x-2 md:gap-x-0 md:divide-x md:divide-gray-500"> <p id="footer_links" class="sr-only">More on this site</p> <a class="hover:text-global-text px-4 py-2 hover:underline md:py-0" href="/"> Home </a><a class="hover:text-global-text px-4 py-2 hover:underline md:py-0" href="/services/"> Services </a><a class="hover:text-global-text px-4 py-2 hover:underline md:py-0" href="/career/"> Career Tools </a><a class="hover:text-global-text px-4 py-2 hover:underline md:py-0" href="/free-tools/"> Networking Tools </a><a class="hover:text-global-text px-4 py-2 hover:underline md:py-0" href="/breakroom/"> Breakroom </a><a class="hover:text-global-text px-4 py-2 hover:underline md:py-0" href="/about/"> About </a> </nav> </footer> <!-- Hide footer navigation links on mobile only -->  </body> </html>